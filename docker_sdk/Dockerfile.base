FROM ubuntu:18.04 

RUN \
  DEBIAN_FRONTEND=noninteractive apt-get update && \
  DEBIAN_FRONTEND=noninteractive apt-get install -y --no-install-recommends \
      software-properties-common \
      wget \
      cpio \
      sudo \
      git \
      lsb-release \
      python3 \
      python3-dev \
      python3-pip \
      python3-setuptools \
      libenchant1c2a && \
  DEBIAN_FRONTEND=noninteractive add-apt-repository ppa:intel-opencl/intel-opencl && apt-get update && \
  DEBIAN_FRONTEND=noninteractive apt-get install -y --no-install-recommends intel-opencl-icd clinfo && \
  pip3 install wheel 

ARG DOWNLOAD_LINK=http://registrationcenter-download.intel.com/akdlm/irc_nas/16670/l_openvino_toolkit_p_2020.3.194.tgz
ARG INSTALL_DIR=/opt/intel/openvino
ARG TEMP_DIR=/tmp/openvino_installer

RUN \
  mkdir -p $TEMP_DIR && cd $TEMP_DIR && \
  wget -c $DOWNLOAD_LINK && \
  tar xf l_openvino_toolkit*.tgz && \
  cd l_openvino_toolkit* && \
  sed -i 's/decline/accept/g' silent.cfg && \
  ./install.sh -s silent.cfg && \
  $INSTALL_DIR/install_dependencies/install_openvino_dependencies.sh 

RUN \
  cd $TEMP_DIR && \
  pip3 install -r $INSTALL_DIR/deployment_tools/open_model_zoo/tools/downloader/requirements.in && \
  pip3 install -r $INSTALL_DIR/deployment_tools/model_optimizer/requirements.txt && \
  pip3 install -r $INSTALL_DIR/deployment_tools/model_optimizer/requirements_caffe.txt && \
  pip3 install -r $INSTALL_DIR/deployment_tools/model_optimizer/requirements_tf.txt && \
  pip3 install m2r pyenchant pylint Sphinx safety test-generator 

# The MediaSDK libraries break OpenCL NEO somehow. 
RUN rm /etc/ld.so.conf.d/intel-mediasdk.conf && ldconfig

ENV GI_TYPELIB_PATH="/opt/intel/openvino_2020.3.194/data_processing/gstreamer/lib/girepository-1.0"
ENV GST_PLUGIN_PATH="/opt/intel/openvino_2020.3.194/data_processing/dl_streamer/lib:/opt/intel/openvino_2020.3.194/data_processing/gstreamer/lib/gstreamer-1.0"
ENV GST_PLUGIN_SCANNER="/opt/intel/openvino_2020.3.194/data_processing/gstreamer/bin/gstreamer-1.0/gst-plugin-scanner"
ENV GST_SAMPLES_DIR="/opt/intel/openvino_2020.3.194/data_processing/dl_streamer/samples"
ENV GST_VAAPI_ALL_DRIVERS="1"
ENV HDDL_INSTALL_DIR="/opt/intel/openvino_2020.3.194/deployment_tools/inference_engine/external/hddl"
ENV INTEL_CVSDK_DIR="/opt/intel/openvino_2020.3.194"
ENV INTEL_OPENVINO_DIR="/opt/intel/openvino_2020.3.194"
ENV InferenceEngine_DIR="/opt/intel/openvino_2020.3.194/deployment_tools/inference_engine/share"
ENV LD_LIBRARY_PATH="/opt/intel/openvino_2020.3.194/data_processing/dl_streamer/lib:/opt/intel/openvino_2020.3.194/data_processing/gstreamer/lib:/opt/intel/openvino_2020.3.194/opencv/lib:/opt/intel/openvino_2020.3.194/deployment_tools/ngraph/lib:/opt/intel/openvino_2020.3.194/deployment_tools/inference_engine/external/hddl/lib:/opt/intel/openvino_2020.3.194/deployment_tools/inference_engine/external/gna/lib:/opt/intel/openvino_2020.3.194/deployment_tools/inference_engine/external/mkltiny_lnx/lib:/opt/intel/openvino_2020.3.194/deployment_tools/inference_engine/external/tbb/lib:/opt/intel/openvino_2020.3.194/deployment_tools/inference_engine/lib/intel64:/opt/intel/openvino_2020.3.194/data_processing/dl_streamer/lib:/opt/intel/openvino_2020.3.194/data_processing/gstreamer/lib:/opt/intel/openvino_2020.3.194/opencv/lib:/opt/intel/openvino_2020.3.194/deployment_tools/ngraph/lib:/opt/intel/openvino_2020.3.194/deployment_tools/inference_engine/external/hddl/lib:/opt/intel/openvino_2020.3.194/deployment_tools/inference_engine/external/gna/lib:/opt/intel/openvino_2020.3.194/deployment_tools/inference_engine/external/mkltiny_lnx/lib:/opt/intel/openvino_2020.3.194/deployment_tools/inference_engine/external/tbb/lib:/opt/intel/openvino_2020.3.194/deployment_tools/inference_engine/lib/intel64:"
ENV LIBRARY_PATH="/opt/intel/openvino_2020.3.194/data_processing/dl_streamer/lib:/opt/intel/openvino_2020.3.194/data_processing/gstreamer/lib:/opt/intel/openvino_2020.3.194/data_processing/dl_streamer/lib:/opt/intel/openvino_2020.3.194/data_processing/gstreamer/lib:"
ENV MODELS_PATH="/root/intel/dl_streamer/models"
ENV OpenCV_DIR="/opt/intel/openvino_2020.3.194/opencv/cmake"
ENV PATH="/opt/intel/openvino_2020.3.194/deployment_tools/model_optimizer:/opt/intel/openvino_2020.3.194/data_processing/gstreamer/bin:/opt/intel/openvino_2020.3.194/data_processing/gstreamer/bin/gstreamer-1.0:/opt/intel/openvino_2020.3.194/deployment_tools/model_optimizer:/opt/intel/openvino_2020.3.194/data_processing/gstreamer/bin:/opt/intel/openvino_2020.3.194/data_processing/gstreamer/bin/gstreamer-1.0:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"
ENV PKG_CONFIG_PATH="/opt/intel/openvino_2020.3.194/data_processing/dl_streamer/lib/pkgconfig:/opt/intel/openvino_2020.3.194/data_processing/gstreamer/lib/pkgconfig:/opt/intel/openvino_2020.3.194/data_processing/dl_streamer/lib/pkgconfig:/opt/intel/openvino_2020.3.194/data_processing/gstreamer/lib/pkgconfig:"
ENV PYTHONPATH="/opt/intel/openvino_2020.3.194/python/python3.6:/opt/intel/openvino_2020.3.194/python/python3:/opt/intel/openvino_2020.3.194/deployment_tools/open_model_zoo/tools/accuracy_checker:/opt/intel/openvino_2020.3.194/deployment_tools/model_optimizer:/opt/intel/openvino_2020.3.194/data_processing/dl_streamer/python:/opt/intel/openvino_2020.3.194/data_processing/gstreamer/lib/python3.6/site-packages:/opt/intel/openvino_2020.3.194/python/python3.6:/opt/intel/openvino_2020.3.194/python/python3:/opt/intel/openvino_2020.3.194/deployment_tools/open_model_zoo/tools/accuracy_checker:/opt/intel/openvino_2020.3.194/deployment_tools/model_optimizer:/opt/intel/openvino_2020.3.194/data_processing/dl_streamer/python:/opt/intel/openvino_2020.3.194/data_processing/gstreamer/lib/python3.6/site-packages:"
ENV ngraph_DIR="/opt/intel/openvino_2020.3.194/deployment_tools/ngraph/cmake"
